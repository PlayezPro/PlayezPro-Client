<app-topbar></app-topbar>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

<app-loader *ngIf="isLoading" />

<section *ngIf="!isLoading" class="section reels_section">
  <div class="reels-container" #reelsContainer>
    <div class="reels_video" *ngFor="let post of posts; let i = index" [class.active]="i === currentIndex">
      <!-- contendor de video -->
      <div class="vid">
        <!-- VIDEO PARA TESTING, ELIMINAR AL PASAR A DESPILEGUE-->
        <!-- <video #videoPlayer src="../../../assets/videos/1.mp4"></video>  -->
        <video #videoPlayer [src]="post.file" autoplay loop></video>
        <!-- controladores con informacion del reel  -->
        <div class="info">
          <div class="options">
            <div>
              <div>
                <img 
                [src]="imageSrc" 
                class="h-8 ml-3 border-none" 
                alt="PlayezPro Logo"
                (click)="changeImage(); addLike(post._id)"
                >
                <span>{{post.totalLikes}}</span>
              </div>

            </div>
            <div>
              <i class="bi bi-chat" (click)="setOpen(post, true)"></i>
              <span>{{post.totalLikes}}</span>
            </div>
            <!-- Action Sheet button -->
            <div>
              <button (click)="sharePost(post._id)">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                width="32.000000pt" height="32.000000pt" viewBox="0 0 32.000000 32.000000"
                preserveAspectRatio="xMidYMid meet">
               
               <g transform="translate(0.000000,32.000000) scale(0.100000,-0.100000)"
               fill="#FFFFFF" stroke="none">
               <path d="M138 305 c-35 -20 -58 -64 -58 -112 0 -28 -8 -46 -32 -73 l-33 -35
               32 29 32 28 40 -33 40 -34 -22 -25 c-20 -22 -19 -22 11 3 19 15 46 27 60 27
               100 0 147 133 73 204 -36 35 -102 44 -143 21z m50 -47 c-4 -26 -30 -43 -52
               -35 -21 8 -21 53 1 66 25 13 55 -5 51 -31z m74 25 c11 -13 13 -25 7 -40 -9
               -25 -21 -28 -50 -13 -23 13 -24 28 -2 52 20 22 26 22 45 1z m-99 -92 c7 -27
               -11 -51 -38 -51 -28 0 -43 33 -25 55 18 21 57 19 63 -4z m130 -2 c15 -24 1
               -49 -27 -49 -26 0 -40 22 -30 52 7 23 42 21 57 -3z m-64 -43 c9 -11 10 -20 1
               -35 -21 -40 -79 -15 -65 29 7 24 46 27 64 6z"/>
               <path d="M40 45 c-24 -25 -42 -45 -39 -45 3 0 25 20 49 45 24 25 42 45 39 45
               -3 0 -25 -20 -49 -45z"/>
               </g>
               </svg></button>
            </div>
          </div>

          <div class="profile">
            <div class="row">
              <img class="profile-img" src="../../../assets/images/2.jpg">
              <h4> {{ post.userDetails?.[0]?.name }}</h4>
              <!-- <button (click)="passUserId(post.users_id)">Follow</button> -->
              <app-btn-follow (click)="passUserId(post.users_id)" />
            </div>
            <div class="row row2">
              <p>{{ post.title }} | {{ post.category }}</p>
            </div>
            <div class="row">
              <p class="audio">{{ post.description }}</p>
            </div>
          </div>
        </div>

        <!-- Modal de comentarios -->
        <ion-list lines="h-[50%] full" class="likeMenu">
          <ion-modal [isOpen]="post.isModalOpen">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-title>Comentarios</ion-title>
                  <ion-buttons slot="end">
                    <ion-button (click)="setOpen(post, false)">Close</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content class="ion-padding" style="display: flex; flex-direction: column;">
                <ion-list style="flex: 1;">
                  <ng-container *ngFor="let comment of post.allComments">
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 15px;">
                      <img style="width: 10%; height: 10%; " src="../../assets/userPic/profileIcon.png" alt="profile">
                      <div style="display: flex; flex-direction: column;">
                        <p style="font-size: 10px;">{{ comment.userComment?.[0]?.name }}</p>
                        <div style="display: flex; flex-direction: row; gap: 25px;">
                          <p style="margin-top: 1px;">{{ comment.comments }}</p>
                          <ion-icon color="danger" *ngIf="comment.users_id === getUserId()" name="trash-outline"
                          (click)="deleteComment(post._id, comment._id)"></ion-icon>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </ion-list>
              </ion-content>
              <ion-footer style="height: 100px;">
                <ion-item>
                  <ion-input placeholder="AÃ±ade un comentario" (input)="toggleIcon($event)"></ion-input>
                  <ion-icon color="primary" name="arrow-up-outline" slot="end" *ngIf="mostrarIcono"
                    (click)="addComment(post._id, comentarioTexto)"></ion-icon>
                </ion-item>
              </ion-footer>
            </ng-template>
          </ion-modal>
        </ion-list>
      </div>
    </div>
  </div>
</section>
<app-navbar>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

<app-loader *ngIf="isLoading" />

<section *ngIf="!isLoading" class="section reels_section">
  <div class="reels-container">
    <div class="reels_video" *ngFor="let post of posts">

      <div class="head-part">
        <h4>Reel</h4>
        <i class="bi bi-camera"></i>
      </div>
      <!-- contendor de video -->
      <div class="vid">
        <!-- <video #videoPlayer src="../../../assets/videos/1.mp4"></video> -->
        <video #videoPlayer [src]="post.file" autoplay loop></video>
        <!-- controladores con informacion del reel  -->
        <div class="info">
          <div class="options">
            <div>
              <ion-button fill="clear" (click)="addLike(post._id)">
                <ion-icon slot="icon-only" size="large" [ngClass]="{'ball-fill': post.hasLikes, 'ball': !post.hasLikes}"></ion-icon>
              </ion-button>
               <span>{{post.totalLikes}}</span>             
              <!-- <ion-button color="white" style="margin-top: -4px;" fill="clear" expand="block" (click)="setOpen(post, true)">
                <ion-icon slot="icon-only" size="large" name="chatbubble-outline"></ion-icon>
              </ion-button> -->            
            </div>
            <div>
              <i class="bi bi-chat" (click)="setOpen(post, true)"></i>
              <span>{{post.totalLikes}}</span>
            </div>
            <div>
              <i class="bi bi-send"></i>
            </div>
            <i class="bi bi-three-dots-vertical"></i>
            <!-- <img src="../../../assets/images/2.jpg"> -->
          </div>
          <div class="profile">
            <div class="row">
              <img class="profile-img" src="../../../assets/images/2.jpg">
              <h4> {{ post.userDetails?.[0]?.name }}</h4>
              <button (click)="passUserId(post.users_id)">Follow</button>
            </div>
            <div class="row row2">
              <p>{{ post.title }} | {{ post.category }}</p>
            </div>
            <div class="row">
              <p class="audio">{{ post.description }}</p>
            </div>
          </div>
        </div>


        <!-- <div class="reels_video">
          <img style="width: 5%; height: 5%; " src="../../assets/userPic/profileIcon.png" alt="profile">
          <p (click)="passUserId(post.users_id)" style="color: green; cursor: pointer;">
            {{ post.userDetails?.[0]?.name }}
          </p>
        </div> -->

        <!-- <div style="margin-bottom: 10px;"> -->
        <!-- <ion-img class="img" *ngIf="isImage(post.file); else videoPlayer" [src]="post.file" alt="Imagen"></ion-img> -->
        <!-- <ng-template #videoPlayer>
            <video [src]="post.file" loop></video>
          </ng-template> -->
        <!-- </div> -->

        <!-- Modal de comentarios -->
        <ion-list lines="h-[50%] full" class="likeMenu">
          <ion-modal [isOpen]="post.isModalOpen">
            <ng-template>
              <ion-header>
                <ion-toolbar>
                  <ion-title>Comentarios</ion-title>
                  <ion-buttons slot="end">
                    <ion-button (click)="setOpen(post, false)">Close</ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-header>
              <ion-content class="ion-padding" style="display: flex; flex-direction: column;">
                <ion-list style="flex: 1;">
                  <ng-container *ngFor="let comment of post.allComments">
                    <div style="display: flex; flex-direction: row; align-items: center; gap: 15px;">
                      <img style="width: 10%; height: 10%; " src="../../assets/userPic/profileIcon.png" alt="profile">
                      <div style="display: flex; flex-direction: column;">
                        <p style="font-size: 10px;">{{ comment.userComment?.[0]?.name }}</p>
                        <div style="display: flex; flex-direction: row; gap: 25px;">
                          <p style="margin-top: 1px;">{{ comment.comments }}</p>
                          <ion-icon color="danger" *ngIf="comment.users_id === getUserId()" name="trash-outline"
                            (click)="deleteComment(comment._id)"></ion-icon>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                </ion-list>
              </ion-content>
              <ion-footer style="height: 100px;">
                <ion-item>
                  <ion-input placeholder="Añade un comentario" (input)="toggleIcon($event)"></ion-input>
                  <ion-icon color="primary" name="arrow-up-outline" slot="end" *ngIf="mostrarIcono"
                    (click)="addComment(post._id, comentarioTexto)"></ion-icon>
                </ion-item>
              </ion-footer>
            </ng-template>
          </ion-modal>
        </ion-list>
      </div>
    </div>
  </div>
</section>




<!-- <ion-content *ngIf="!isLoading">
  <ion-list>
    <div *ngFor="let post of posts; let i = index" class="post-item" style="margin-top: 5%;">
      <div
        style="display: flex; flex-direction: row; align-items: center; gap: 20px; margin-left: 10px; position: absolute;">
        <img style="width: 5%; height: 5%; " src="../../assets/userPic/profileIcon.png" alt="profile">
        <p (click)="passUserId(post.users_id)" style="color: green; cursor: pointer;">
          {{ post.userDetails?.[0]?.name }}
        </p>
      </div>

      <div style="margin-bottom: 10px;">
        <ion-img class="img" *ngIf="isImage(post.file); else videoPlayer" [src]="post.file" alt="Imagen"></ion-img>
        <ng-template #videoPlayer>
          <video [src]="post.file" loop></video>
        </ng-template>
      </div>

      <div style="display: flex; flex-direction: row; gap: 15px;">
        <ion-button color="dark" style="margin-top: -4px;" fill="clear" (click)="addLike(post._id)">
          <ion-icon slot="icon-only" size="large" [name]="post.hasLikes ? 'heart' : 'heart-outline'"></ion-icon>
        </ion-button>
        <ion-button color="dark" style="margin-top: -4px;" fill="clear" expand="block" (click)="setOpen(post, true)">
          <ion-icon slot="icon-only" size="large" name="chatbubble-outline"></ion-icon>
        </ion-button>
        <ion-icon size="large" name="share-outline"></ion-icon>
      </div>

      <ion-label class="label">
        <div>
          <p>{{post.totalLikes}} Me gusta</p>
        </div>
        <div style="display: flex; flex-direction: row; gap: 5px; margin-top: 10px;">
          <p (click)="passUserId(post.users_id)" style="color: green; cursor: pointer;">
            {{ post.userDetails?.[0]?.name }}
          </p>
          <p>{{ post.description }}</p>
        </div>
      </ion-label>

      <ion-list lines="full" class="likeMenu">
        <ion-modal [isOpen]="post.isModalOpen">
          <ng-template>
            <ion-header>
              <ion-toolbar>
                <ion-title>Comentarios</ion-title>
                <ion-buttons slot="end">
                  <ion-button (click)="setOpen(post, false)">Close</ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-header>
            <ion-content class="ion-padding" style="display: flex; flex-direction: column;">
              <ion-list style="flex: 1;">
                <ng-container *ngFor="let comment of post.allComments">
                  <div style="display: flex; flex-direction: row; align-items: center; gap: 15px;">
                    <img style="width: 10%; height: 10%; " src="../../assets/userPic/profileIcon.png" alt="profile">
                    <div style="display: flex; flex-direction: column;">
                      <p style="font-size: 10px;">{{ comment.userComment?.[0]?.name }}</p>
                      <div style="display: flex; flex-direction: row; gap: 25px;">
                        <p style="margin-top: 1px;">{{ comment.comments }}</p>
                        <ion-icon color="danger" *ngIf="comment.users_id === getUserId()" name="trash-outline"
                          (click)="deleteComment(comment._id)"></ion-icon>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ion-list>
            </ion-content>
            <ion-footer style="height: 100px;">
              <ion-item>
                <ion-input placeholder="Añade un comentario" (input)="toggleIcon($event)"></ion-input>
                <ion-icon color="primary" name="arrow-up-outline" slot="end" *ngIf="mostrarIcono"
                  (click)="addComment(post._id, comentarioTexto)"></ion-icon>
              </ion-item>
            </ion-footer>
          </ng-template>
        </ion-modal>
      </ion-list>
    </div>
  </ion-list>
</ion-content> -->
<app-navbar />